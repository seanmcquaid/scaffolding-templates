# TypeScript Library Template - Agent Instructions

The role of this file is to describe common mistakes and confusion points that agents might encounter as they work in this project. If you ever encounter something like this in the project, please alert the developer working with you and indicate this is the case in the AGENTS.md file to help prevent future agents from having the same issue.

## Commands

```bash
# Install dependencies
pnpm install

# Build the library (generates dist/)
pnpm build

# Run unit tests
pnpm test

# Run tests in watch mode
pnpm test:watch

# Run tests with coverage
pnpm test:coverage

# Run linting
pnpm lint

# Fix lint errors
pnpm lint:fix

# Type checking (via build)
pnpm build

# Check bundle size
pnpm bundlesize

# Check tree-shaking
pnpm check-treeshaking

# Check package exports and types
pnpm check-types
```

## Guiding Principles

### 1. Public API Is the Contract
The `src/index.ts` barrel export is the library's public contract. Keep it minimal and intentional. Every exported symbol is a commitment to consumers — adding is easy, removing is a breaking change.

### 2. Tests Are Mandatory
Every exported function and behavior needs tests. Focus on:
- **Unit tests (Vitest)** testing the public API surface and edge cases
- Cover both happy paths and error conditions
- Aim for 100% coverage of all exported utilities

### 3. Dual ESM/CJS Compatibility
Both module formats must work correctly. When adding new entry points, update the `exports` field in `package.json` for both formats. Test with `pnpm check-types` and `pnpm check-treeshaking` before shipping.

### 4. Bundle Size Discipline
Every dependency you add is a cost to every consumer. Prefer zero-dependency solutions. When a dependency is necessary, verify it's tree-shakeable with `pnpm check-treeshaking` and monitor bundle size with `pnpm bundlesize`.

### 5. Type Safety Is Part of the API
TypeScript types are part of the public API. Design types first, then implement. All exported functions must have full type annotations — no `any`, no implicit `unknown`.

### 6. Right Level of Abstraction
- Each module in `src/` does one thing. Single Responsibility Principle strictly applies.
- Keep the public API as small as possible — you can always add, but you can't remove without a breaking change.
- Only abstract shared internal logic once you've seen the pattern repeated at least twice.

## Common Mistakes and Confusion Points

### 1. Dual ESM/CJS Exports
- This library is built with `tsdown` and exports both ESM and CJS formats. The `package.json` `exports` field maps entry points to both formats. When adding new entry points, update both the source and the `exports` field in `package.json`. Failing to do so will break consumers using one of the module formats.

### 2. No React / No Browser APIs
- This is a **framework-agnostic TypeScript library**. Do not add React, DOM APIs, or browser-specific code unless explicitly intended as a browser-only utility. Keep dependencies minimal.

### 3. `dist/` is Generated
- The `dist/` directory is generated by `pnpm build` and should not be edited manually or committed. It is in `.gitignore`. If you see `dist/` in your working tree, it was generated locally — do not stage it.

### 4. Publishing with Changesets
- Version bumps and publishing use **Changesets**. Do not manually edit the `version` field in `package.json`. Run `pnpm changeset` to create a changeset file, then let the CI workflow handle the version bump and publish.

### 5. Package Manager
- Use **`pnpm`** only. Do not use `npm install` or `yarn add`.

### 6. TypeScript Strict Mode
- The library uses strict TypeScript. Avoid `any` types and ensure all exported APIs are fully typed. Type exports are part of the public API surface.
